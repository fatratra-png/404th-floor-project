<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Floor 3 // Emergency Brake</title>
    <link rel="stylesheet" href="src/styles/output.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap"
      rel="stylesheet"
    />

    <style>
      /* â”€â”€ Root & Variables â”€â”€ */
      :root {
        --red: #da3633;
        --orange: #f97316;
        --yellow: #eab308;
        --green: #22c55e;
        --blue: #3b82f6;
        --bg: #0a0d12;
        --panel: #0f1318;
        --border: #1e2530;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Share Tech Mono", monospace;
        background: var(--bg);
        color: #94a3b8;
        height: 100vh;
        overflow: hidden;
        position: relative;
      }

      /* â”€â”€ Scanlines overlay â”€â”€ */
      body::after {
        content: "";
        position: fixed;
        inset: 0;
        background: repeating-linear-gradient(
          0deg,
          transparent,
          transparent 3px,
          rgba(0, 0, 0, 0.08) 3px,
          rgba(0, 0, 0, 0.08) 4px
        );
        pointer-events: none;
        z-index: 1000;
      }

      /* â”€â”€ Noise texture â”€â”€ */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
        opacity: 0.4;
        pointer-events: none;
        z-index: 999;
      }

      /* â”€â”€ Topbar â”€â”€ */
      #floor3-topbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1.5rem;
        height: 52px;
        background: var(--panel);
        border-bottom: 1px solid var(--red);
        position: relative;
        z-index: 10;
      }

      .topbar-left {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .topbar-icon {
        color: var(--red);
        font-size: 1.1rem;
        animation: pulse-red 1s ease-in-out infinite;
      }

      .topbar-title {
        font-family: "Orbitron", monospace;
        font-size: 0.9rem;
        font-weight: 700;
        color: #e2e8f0;
        letter-spacing: 0.1em;
      }

      .topbar-subtitle {
        font-size: 0.65rem;
        color: var(--red);
        letter-spacing: 0.15em;
        animation: pulse-red 1.5s ease-in-out infinite;
      }

      .topbar-right {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .conn-badge {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        border: 1px solid rgba(239, 68, 68, 0.3);
        padding: 0.25rem 0.75rem;
        border-radius: 2px;
        font-size: 0.65rem;
        color: var(--red);
        letter-spacing: 0.1em;
      }

      .conn-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--red);
        animation: blink 0.8s step-end infinite;
      }

      .icon-btn {
        width: 34px;
        height: 34px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid var(--border);
        background: transparent;
        color: #64748b;
        cursor: pointer;
        border-radius: 2px;
        font-size: 1rem;
        transition: all 0.15s;
      }
      .icon-btn:hover {
        border-color: var(--blue);
        color: var(--blue);
      }

      /* â”€â”€ Main Layout â”€â”€ */
      #floor3-root {
        display: grid;
        grid-template-columns: 1fr 380px;
        height: calc(100vh - 52px);
        gap: 0;
      }

      /* â”€â”€ Left Panel â€” Brake Mechanism â”€â”€ */
      #brake-panel {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        position: relative;
        background:
          radial-gradient(
            ellipse 60% 40% at 50% 30%,
            rgba(239, 68, 68, 0.04) 0%,
            transparent 70%
          ),
          var(--bg);
      }

      /* â”€â”€ Alert Banner â”€â”€ */
      #f3-alert {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.4);
        border-left: 3px solid var(--red);
        padding: 0.6rem 1.25rem;
        border-radius: 2px;
        font-size: 0.7rem;
        color: var(--red);
        letter-spacing: 0.12em;
        width: 100%;
        max-width: 580px;
        margin-bottom: 2rem;
        animation: pulse-red-bg 1s ease-in-out infinite;
      }

      #f3-alert span {
        font-size: 1rem;
      }

      /* â”€â”€ Brake Visual â”€â”€ */
      .brake-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0;
        margin-bottom: 2rem;
      }

      /* Button on top */
      #f3-tap-btn {
        width: 120px;
        height: 80px;
        background: linear-gradient(
          180deg,
          #ef4444 0%,
          #b91c1c 60%,
          #991b1b 100%
        );
        border: none;
        border-radius: 6px 6px 0 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        box-shadow:
          0 0 0 2px #7f1d1d,
          0 0 20px rgba(239, 68, 68, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        transition:
          transform 0.05s,
          box-shadow 0.05s;
        position: relative;
        z-index: 2;
        user-select: none;
      }

      #f3-tap-btn:active,
      #f3-tap-btn.pressed {
        transform: translateY(4px);
        box-shadow:
          0 0 0 2px #7f1d1d,
          0 0 8px rgba(239, 68, 68, 0.2),
          inset 0 2px 4px rgba(0, 0, 0, 0.4);
      }

      /* Shaft */
      .brake-shaft {
        width: 28px;
        background: linear-gradient(90deg, #1e293b, #334155, #1e293b);
        height: 160px;
        border-left: 1px solid #475569;
        border-right: 1px solid #475569;
        position: relative;
        z-index: 1;
      }

      .brake-shaft::before,
      .brake-shaft::after {
        content: "";
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--yellow);
        left: 50%;
        transform: translateX(-50%);
        box-shadow: 0 0 6px var(--yellow);
      }
      .brake-shaft::before {
        top: 35%;
      }
      .brake-shaft::after {
        top: 65%;
      }

      /* Base plate */
      .brake-base {
        width: 220px;
        height: 28px;
        background: linear-gradient(180deg, #334155 0%, #1e293b 100%);
        border: 1px solid #475569;
        border-radius: 2px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.6rem;
        letter-spacing: 0.2em;
        color: #64748b;
      }

      /* â”€â”€ CTA Box â”€â”€ */
      .cta-box {
        border: 1px solid rgba(59, 130, 246, 0.4);
        background: rgba(59, 130, 246, 0.05);
        border-radius: 4px;
        padding: 1rem 2rem;
        text-align: center;
        max-width: 320px;
      }

      .cta-label {
        font-size: 0.6rem;
        color: #64748b;
        letter-spacing: 0.2em;
        margin-bottom: 0.5rem;
      }

      .cta-key {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-family: "Orbitron", monospace;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--blue);
        letter-spacing: 0.15em;
      }

      .cta-key span {
        font-size: 1rem;
      }

      .cta-hint {
        font-size: 0.6rem;
        color: #475569;
        margin-top: 0.5rem;
      }

      /* Status */
      #f3-status {
        margin-top: 1.5rem;
        font-size: 0.75rem;
        letter-spacing: 0.2em;
        color: #475569;
        min-height: 1.5rem;
      }

      /* Sustain bar */
      .sustain-track {
        width: 100%;
        max-width: 320px;
        height: 4px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 2px;
        margin-top: 1rem;
        overflow: hidden;
      }

      #f3-sustain-bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, var(--blue), var(--green));
        border-radius: 2px;
        transition: width 0.1s linear;
      }

      /* Bottom ticker */
      .bottom-ticker {
        position: absolute;
        bottom: 1rem;
        left: 2rem;
        right: 2rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 0.6rem;
        color: #334155;
        letter-spacing: 0.1em;
      }

      .ticker-alert {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        color: var(--red);
        animation: blink 1s step-end infinite;
      }

      .ticker-dot {
        width: 5px;
        height: 5px;
        border-radius: 50%;
        background: var(--red);
      }

      /* â”€â”€ Right Panel â€” Gauge â”€â”€ */
      #gauge-panel {
        border-left: 1px solid var(--border);
        background: var(--panel);
        display: flex;
        flex-direction: column;
        padding: 1.5rem;
        gap: 1rem;
      }

      /* Metrics row */
      .metrics-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
      }

      .metric-card {
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.02);
        padding: 0.85rem 1rem;
        border-radius: 2px;
      }

      .metric-card-label {
        font-size: 0.6rem;
        letter-spacing: 0.2em;
        color: #475569;
        margin-bottom: 0.5rem;
      }

      .metric-card-value {
        font-family: "Orbitron", monospace;
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--red);
      }

      .metric-card-unit {
        font-size: 0.65rem;
        color: #64748b;
        margin-left: 0.25rem;
      }

      /* Gauge container */
      .gauge-container {
        flex: 1;
        border: 1px solid var(--border);
        background: #050709;
        border-radius: 2px;
        padding: 1rem;
        position: relative;
        display: flex;
        flex-direction: column;
      }

      .gauge-title {
        font-size: 0.6rem;
        letter-spacing: 0.2em;
        color: #475569;
        margin-bottom: 1rem;
      }

      /* The bar track */
      .gauge-track-wrapper {
        flex: 1;
        display: flex;
        gap: 1rem;
        position: relative;
      }

      /* Y-axis labels */
      .gauge-y-axis {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        font-size: 0.6rem;
        color: #334155;
        padding-bottom: 2px;
        text-align: right;
        min-width: 36px;
      }

      /* Bar track */
      .gauge-bar-track {
        flex: 1;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid var(--border);
        border-radius: 2px;
        position: relative;
        overflow: hidden;
      }

      /* Gradient fill zones background */
      .gauge-bar-track::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          to top,
          rgba(239, 68, 68, 0.15) 0%,
          rgba(234, 179, 8, 0.15) 35%,
          rgba(34, 197, 94, 0.15) 80%,
          rgba(34, 197, 94, 0.25) 100%
        );
      }

      /* Target line */
      .gauge-target-line {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 88%;
        height: 1px;
        background: rgba(59, 130, 246, 0.6);
        z-index: 5;
      }

      .gauge-target-label {
        position: absolute;
        right: 4px;
        bottom: 89%;
        font-size: 0.55rem;
        color: var(--blue);
        letter-spacing: 0.05em;
        background: #050709;
        padding: 1px 3px;
      }

      /* Safe zone label */
      .safe-zone-label {
        position: absolute;
        right: 6px;
        top: 4px;
        font-size: 0.5rem;
        color: rgba(34, 197, 94, 0.5);
        letter-spacing: 0.1em;
        writing-mode: vertical-rl;
      }

      /* Lock icon */
      .gauge-lock {
        position: absolute;
        top: 6px;
        right: 6px;
        font-size: 0.65rem;
        color: #334155;
      }

      /* Danger icon */
      .gauge-danger {
        position: absolute;
        bottom: 4px;
        right: 4px;
        color: var(--red);
        font-size: 0.65rem;
      }

      /* The actual bar */
      #f3-gauge-bar {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 0%;
        background: linear-gradient(to top, #dc2626, #ef4444);
        transition:
          height 0.08s linear,
          background 0.3s;
        border-radius: 1px 1px 0 0;
      }

      /* Tick marks */
      .gauge-ticks {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        pointer-events: none;
      }

      .gauge-tick {
        width: 100%;
        height: 1px;
        background: rgba(255, 255, 255, 0.03);
      }

      /* Bottom status bar */
      .gauge-status-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 0.5rem;
        font-size: 0.6rem;
      }

      .pressure-readout {
        display: flex;
        align-items: baseline;
        gap: 0.25rem;
      }

      .pressure-big {
        font-family: "Orbitron", monospace;
        font-size: 1.5rem;
        font-weight: 700;
        color: #e2e8f0;
        line-height: 1;
      }

      .pressure-pct {
        font-size: 0.7rem;
        color: #64748b;
      }

      /* â”€â”€ Animations â”€â”€ */
      @keyframes pulse-red {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      @keyframes pulse-red-bg {
        0%,
        100% {
          background: rgba(239, 68, 68, 0.1);
        }
        50% {
          background: rgba(239, 68, 68, 0.18);
        }
      }

      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0;
        }
      }

      @keyframes shake-once {
        0%,
        100% {
          transform: translateX(0);
        }
        15% {
          transform: translateX(-5px);
        }
        30% {
          transform: translateX(5px);
        }
        45% {
          transform: translateX(-3px);
        }
        60% {
          transform: translateX(3px);
        }
        75% {
          transform: translateX(-2px);
        }
        90% {
          transform: translateX(2px);
        }
      }

      .animate-shake-once {
        animation: shake-once 0.35s ease-in-out;
      }

      /* Victory overlay */
      #f3-complete-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.85);
        z-index: 500;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 1rem;
        animation: fadeIn 0.5s ease;
      }

      #f3-complete-overlay.show {
        display: flex;
      }

      .victory-title {
        font-family: "Orbitron", monospace;
        font-size: 2rem;
        font-weight: 900;
        color: var(--green);
        letter-spacing: 0.2em;
        text-shadow: 0 0 30px var(--green);
      }

      .victory-sub {
        font-size: 0.75rem;
        color: #64748b;
        letter-spacing: 0.15em;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
    </style>
  </head>

  <body>
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOPBAR
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="floor3-topbar">
      <div class="topbar-left">
        <span class="topbar-icon">âš </span>
        <div>
          <div class="topbar-title">FLOOR 3 // EMERGENCY MODE</div>
        </div>
      </div>
      <div class="topbar-right">
        <div class="conn-badge">
          <div class="conn-dot"></div>
          CONNECTION UNSTABLE
        </div>
        <button class="icon-btn" title="Help">?</button>
        <button
          class="icon-btn"
          title="Settings"
          onclick="Sounds && Sounds.toggleMute()"
        >
          âš™
        </button>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN GRID
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="floor3-root">
      <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ LEFT: BRAKE MECHANISM â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <div id="brake-panel">
        <!-- Alert banner -->
        <div id="f3-alert">
          <span>âš </span>
          <span>âš  &nbsp; CRITICAL FREEFALL DETECTED &nbsp; âš </span>
          <span>âš </span>
        </div>

        <!-- Brake visual -->
        <div class="brake-wrapper">
          <!-- The big red button -->
          <button id="f3-tap-btn" title="MASH THIS">âœ‹</button>

          <!-- Shaft -->
          <div class="brake-shaft"></div>

          <!-- Base plate -->
          <div class="brake-base">MANUAL OVERRIDE</div>
        </div>

        <!-- CTA -->
        <div class="cta-box">
          <div class="cta-label">MANUAL OVERRIDE</div>
          <div class="cta-key">
            <span>âŒ¨</span>
            MASH SPACE
          </div>
          <div class="cta-hint">Repeatedly press to build pressure</div>
        </div>

        <!-- Status & sustain -->
        <div id="f3-status">AWAITING INPUT...</div>
        <div class="sustain-track">
          <div id="f3-sustain-bar"></div>
        </div>

        <!-- Bottom ticker -->
        <div class="bottom-ticker">
          <div class="ticker-alert">
            <div class="ticker-dot"></div>
            SYSTEM ALERT: Impact imminent in 00:15...
          </div>
          <div>ERR_CODE: 404_GRAVITY_NOT_FOUND</div>
        </div>
      </div>

      <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ RIGHT: GAUGE PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <div id="gauge-panel">
        <!-- Metrics row -->
        <div class="metrics-row">
          <div class="metric-card">
            <div class="metric-card-label">DECELERATION</div>
            <div class="metric-card-value">
              -9.8
              <span class="metric-card-unit">m/sÂ²</span>
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-card-label">VELOCITY</div>
            <div
              id="f3-velocity"
              class="metric-card-value"
              style="font-size: 1rem; color: var(--red)"
            >
              CRITICAL
            </div>
          </div>
        </div>

        <!-- Hydraulic gauge -->
        <div class="gauge-container">
          <div class="gauge-title">HYDRAULIC PRESSURE</div>

          <div class="gauge-track-wrapper">
            <!-- Y-axis labels -->
            <div class="gauge-y-axis">
              <span>100%</span>
              <span>90%</span>
              <span>80%</span>
              <span>70%</span>
              <span>60%</span>
              <span>50%</span>
              <span>40%</span>
              <span>30%</span>
              <span>20%</span>
              <span>10%</span>
              <span>0%</span>
            </div>

            <!-- Bar track -->
            <div class="gauge-bar-track">
              <!-- Ticks -->
              <div class="gauge-ticks">
                <div class="gauge-tick"></div>
                <div class="gauge-tick"></div>
                <div class="gauge-tick"></div>
                <div class="gauge-tick"></div>
                <div class="gauge-tick"></div>
                <div class="gauge-tick"></div>
                <div class="gauge-tick"></div>
                <div class="gauge-tick"></div>
                <div class="gauge-tick"></div>
                <div class="gauge-tick"></div>
              </div>

              <!-- Target line at 88% from bottom -->
              <div class="gauge-target-line"></div>
              <div class="gauge-target-label">TARGET PRESSURE</div>

              <!-- Safe zone label -->
              <div class="safe-zone-label">SAFE ZONE</div>

              <!-- Lock icon top right -->
              <div class="gauge-lock">ðŸ”’</div>

              <!-- Danger icon bottom right -->
              <div class="gauge-danger">â–²</div>

              <!-- THE BAR -->
              <div id="f3-gauge-bar"></div>
            </div>
          </div>

          <!-- Status bar -->
          <div class="gauge-status-bar">
            <div class="pressure-readout">
              <div class="pressure-big" id="f3-pressure-label">0</div>
              <div class="pressure-pct">%</div>
            </div>
            <div
              id="f3-status-right"
              style="
                font-size: 0.65rem;
                color: var(--red);
                letter-spacing: 0.1em;
              "
            >
              UNSTABLE
            </div>
          </div>
        </div>

        <!-- Bottom label -->
        <div
          style="
            font-size: 0.6rem;
            color: #334155;
            letter-spacing: 0.15em;
            text-align: center;
            padding: 0.25rem 0;
          "
        >
          HYDRAULIC PRESSURE
          <span
            id="f3-status-badge"
            style="color: var(--red); margin-left: 0.5rem"
            >UNSTABLE</span
          >
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VICTORY OVERLAY
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="f3-complete-overlay">
      <div class="victory-title">âœ“ BRAKES ENGAGED</div>
      <div class="victory-sub">FLOOR 3 CLEARED â€” PROCEEDING TO FLOOR 4...</div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SCRIPTS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script src="src/audio/sounds.js"></script>
    <script src="src/floors/floor3.js"></script>

    <script>
      // Boot Floor 3 quand la page est prÃªte
      document.addEventListener("DOMContentLoaded", () => {
        Floor3.init();
      });

      // Ã‰coute la complÃ©tion (pour intÃ©gration avec main.js de M1)
      document.addEventListener("floor:complete", (e) => {
        if (e.detail.floor === 3) {
          const overlay = document.getElementById("f3-complete-overlay");
          overlay.classList.add("show");
          console.log("[M4] Floor 3 complete â†’ signaling M1");
          // M1 prendra le relais ici
        }
      });

      // Visual feedback sur le bouton
      const tapBtn = document.getElementById("f3-tap-btn");
      tapBtn.addEventListener("pointerdown", () => {
        tapBtn.classList.add("pressed");
      });
      tapBtn.addEventListener("pointerup", () => {
        tapBtn.classList.remove("pressed");
      });

      // Update status badge avec la jauge
      function syncStatusBadge(pressure) {
        const badge = document.getElementById("f3-status-badge");
        const badgeR = document.getElementById("f3-status-right");
        if (pressure >= 90) {
          badge.textContent = "STABLE";
          badge.style.color = "#22c55e";
          badgeR.textContent = "STABLE";
          badgeR.style.color = "#22c55e";
        } else {
          badge.textContent = "UNSTABLE";
          badge.style.color = "var(--red)";
          badgeR.textContent = "UNSTABLE";
          badgeR.style.color = "var(--red)";
        }
      }

      // Monkey-patch updateUI pour sync le badge (optionnel)
      const _origUpdate = Floor3._updateUI;
    </script>
  </body>
</html>
